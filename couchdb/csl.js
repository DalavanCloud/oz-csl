{
  "_id": "_design/csl",
  "_rev": "10-347e526c5091bfa5cc3bef9c90ff55d2",
  "lists": {
    "triples": "function(head,req) { var row; start({ 'headers': { 'Content-Type': 'text/plain' } }); while(row = getRow()) { send(row.value); } }"
  },
  "views": {
    "doi-orcid": {
      "map": "function (doc) {\n  if (doc['message-format']) {\n    if (doc['message-format'] == 'application/vnd.crossref-api-message+json') {\n     // citations\n     for (var i in doc.message.author) {\n       if (doc.message.author[i].ORCID) {\n         var name = '';\n         if (doc.message.author[i].literal) {\n           name = doc.message.author[i].literal;\n         } else {\n           name = doc.message.author[i].given + ' ' + doc.message.author[i].family;\n         }\n          emit(doc.message.DOI, [doc.message.author[i].ORCID.replace(/https?:\\/\\/orcid.org\\//, ''), name, (parseInt(i)+1)]);\n       }    \n     }\n    }\n    \n  if (doc['message-format'] == 'application/vnd.citationstyles.csl+json') {\n    if (doc.message.DOI) {\n      for (var i in doc.message.author) {\n        if (doc.message.author[i].ORCID) {\n          // ignore cases where author is actually all the authors\n          var go = true;\n          if (doc.message.author[i].literal.match(/ and /)) {\n            go = false;\n          }\n          if (go) {\n            emit(doc.message.DOI.toLowerCase(), [doc.message.author[i].ORCID, doc.message.author[i].literal, parseInt(i)+1]);\n          }\n        }\n      }\n    }\n  }    \n    \n  }\n}"
    },
    "citation-doi": {
      "map": "function (doc) {\n  if (doc['message-format']) {\n    if (doc['message-format'] == 'application/vnd.citationstyles.csl+json') {\n     // citations\n     for (var i in doc.message.reference) {\n       if (doc.message.reference[i].DOI) {\n          emit(doc.message.DOI, doc.message.reference[i].DOI);\n       }    \n     }\n    }\n  }\n}"
    },
    "citation-nt": {
      "map": "/*\n\nShared code\n\n\n*/\n//----------------------------------------------------------------------------------------\n// http://stackoverflow.com/a/25715455\nfunction isObject(item) {\n  return (typeof item === \"object\" && !Array.isArray(item) && item !== null);\n}\n\n//----------------------------------------------------------------------------------------\n// http://stackoverflow.com/a/21445415\nfunction uniques(arr) {\n  var a = [];\n  for (var i = 0, l = arr.length; i < l; i++)\n    if (a.indexOf(arr[i]) === -1 && arr[i] !== '')\n      a.push(arr[i]);\n  return a;\n}\n\n\n//----------------------------------------------------------------------------------------\n// Store a triple with optional language code\nfunction triple(subject, predicate, object, language) {\n  var triple = [];\n  triple[0] = subject;\n  triple[1] = predicate;\n  triple[2] = object;\n\n  if (typeof language === 'undefined') {} else {\n    triple[3] = language;\n  }\n\n  return triple;\n}\n\n//----------------------------------------------------------------------------------------\n// Enclose triple in suitable wrapping for HTML display or triplet output\nfunction wrap(s, html) {\n  if (s) {\n\n    if (s.match(/^(http|urn|_:)/)) {\n      s = s.replace(/\\\\_/g, '_');\n\n      // handle < > in URIs such as SICI-based DOIs\n      s = s.replace(/</g, '%3C');\n      s = s.replace(/>/g, '%3E');\n\n      if (html) {\n        s = '&lt;' + s + '&gt;';\n      } else {\n        s = '<' + s + '>';\n      }\n    } else {\n      s = '\"' + s.replace(/\"/g, '\\\\\"') + '\"';\n    }\n  }\n  return s;\n}\n\n//----------------------------------------------------------------------------------------\n// https://css-tricks.com/snippets/javascript/htmlentities-for-javascript/\nfunction htmlEntities(str) {\n  return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n}\n\n//----------------------------------------------------------------------------------------\nfunction detect_language(s) {\n  var language = null;\n  var matched = 0;\n  var parts = [];\n\n  var regexp = [];\n\n  // https://gist.github.com/ryanmcgrath/982242\n  regexp['ja'] = /[\\u3000-\\u303F]|[\\u3040-\\u309F]|[\\u30A0-\\u30FF]|[\\uFF00-\\uFFEF]|[\\u4E00-\\u9FAF]|[\\u2605-\\u2606]|[\\u2190-\\u2195]|\\u203B/g;\n  // http://hjzhao.blogspot.co.uk/2015/09/javascript-detect-chinese-character.html\n  regexp['zh'] = /[\\u4E00-\\uFA29]/g;\n  // http://stackoverflow.com/questions/32709687/js-check-if-string-contains-only-cyrillic-symbols-and-spaces\n  regexp['ru'] = /[\\u0400-\\u04FF]/g;\n\n  for (var i in regexp) {\n    parts = s.match(regexp[i]);\n\n    if (parts != null) {\n      if (parts.length > matched) {\n        language = i;\n        matched = parts.length;\n      }\n    }\n  }\n\n  // require a minimum matching\n  if (matched < 2) {\n    language = null;\n  }\n\n  return language;\n\n}\n\n//----------------------------------------------------------------------------------------\nfunction output(doc, triples) {\n  // CouchDB\n  for (var i in triples) {\n    var s = 0;\n    var p = 1;\n    var o = 2;\n\n    var lang = 3;\n\n    var nquads = wrap(triples[i][s], false) +\n      ' ' + wrap(triples[i][p], false) +\n      ' ' + wrap(triples[i][o], false);\n    if (triples[i][lang]) {\n      nquads += '@' + triples[i][lang];\n    }\n\n    nquads += ' .' + \"\\n\";\n\n    // use cluster_id as the key so triples from different versions are linked together\n    emit(doc._id, nquads);\n    //console.log(nquads);\n  }\n}\n\n//----------------------------------------------------------------------------------------\n// START COUCHDB VIEW\n\nvar Latinise = {};\nLatinise.latin_map = {\n  \"Á\": \"A\",\n  \"Ă\": \"A\",\n  \"Ắ\": \"A\",\n  \"Ặ\": \"A\",\n  \"Ằ\": \"A\",\n  \"Ẳ\": \"A\",\n  \"Ẵ\": \"A\",\n  \"Ǎ\": \"A\",\n  \"Â\": \"A\",\n  \"Ấ\": \"A\",\n  \"Ậ\": \"A\",\n  \"Ầ\": \"A\",\n  \"Ẩ\": \"A\",\n  \"Ẫ\": \"A\",\n  \"Ä\": \"A\",\n  \"Ǟ\": \"A\",\n  \"Ȧ\": \"A\",\n  \"Ǡ\": \"A\",\n  \"Ạ\": \"A\",\n  \"Ȁ\": \"A\",\n  \"À\": \"A\",\n  \"Ả\": \"A\",\n  \"Ȃ\": \"A\",\n  \"Ā\": \"A\",\n  \"Ą\": \"A\",\n  \"Å\": \"A\",\n  \"Ǻ\": \"A\",\n  \"Ḁ\": \"A\",\n  \"Ⱥ\": \"A\",\n  \"Ã\": \"A\",\n  \"Ꜳ\": \"AA\",\n  \"Æ\": \"AE\",\n  \"Ǽ\": \"AE\",\n  \"Ǣ\": \"AE\",\n  \"Ꜵ\": \"AO\",\n  \"Ꜷ\": \"AU\",\n  \"Ꜹ\": \"AV\",\n  \"Ꜻ\": \"AV\",\n  \"Ꜽ\": \"AY\",\n  \"Ḃ\": \"B\",\n  \"Ḅ\": \"B\",\n  \"Ɓ\": \"B\",\n  \"Ḇ\": \"B\",\n  \"Ƀ\": \"B\",\n  \"Ƃ\": \"B\",\n  \"Ć\": \"C\",\n  \"Č\": \"C\",\n  \"Ç\": \"C\",\n  \"Ḉ\": \"C\",\n  \"Ĉ\": \"C\",\n  \"Ċ\": \"C\",\n  \"Ƈ\": \"C\",\n  \"Ȼ\": \"C\",\n  \"Ď\": \"D\",\n  \"Ḑ\": \"D\",\n  \"Ḓ\": \"D\",\n  \"Ḋ\": \"D\",\n  \"Ḍ\": \"D\",\n  \"Ɗ\": \"D\",\n  \"Ḏ\": \"D\",\n  \"ǲ\": \"D\",\n  \"ǅ\": \"D\",\n  \"Đ\": \"D\",\n  \"Ƌ\": \"D\",\n  \"Ǳ\": \"DZ\",\n  \"Ǆ\": \"DZ\",\n  \"É\": \"E\",\n  \"Ĕ\": \"E\",\n  \"Ě\": \"E\",\n  \"Ȩ\": \"E\",\n  \"Ḝ\": \"E\",\n  \"Ê\": \"E\",\n  \"Ế\": \"E\",\n  \"Ệ\": \"E\",\n  \"Ề\": \"E\",\n  \"Ể\": \"E\",\n  \"Ễ\": \"E\",\n  \"Ḙ\": \"E\",\n  \"Ë\": \"E\",\n  \"Ė\": \"E\",\n  \"Ẹ\": \"E\",\n  \"Ȅ\": \"E\",\n  \"È\": \"E\",\n  \"Ẻ\": \"E\",\n  \"Ȇ\": \"E\",\n  \"Ē\": \"E\",\n  \"Ḗ\": \"E\",\n  \"Ḕ\": \"E\",\n  \"Ę\": \"E\",\n  \"Ɇ\": \"E\",\n  \"Ẽ\": \"E\",\n  \"Ḛ\": \"E\",\n  \"Ꝫ\": \"ET\",\n  \"Ḟ\": \"F\",\n  \"Ƒ\": \"F\",\n  \"Ǵ\": \"G\",\n  \"Ğ\": \"G\",\n  \"Ǧ\": \"G\",\n  \"Ģ\": \"G\",\n  \"Ĝ\": \"G\",\n  \"Ġ\": \"G\",\n  \"Ɠ\": \"G\",\n  \"Ḡ\": \"G\",\n  \"Ǥ\": \"G\",\n  \"Ḫ\": \"H\",\n  \"Ȟ\": \"H\",\n  \"Ḩ\": \"H\",\n  \"Ĥ\": \"H\",\n  \"Ⱨ\": \"H\",\n  \"Ḧ\": \"H\",\n  \"Ḣ\": \"H\",\n  \"Ḥ\": \"H\",\n  \"Ħ\": \"H\",\n  \"Í\": \"I\",\n  \"Ĭ\": \"I\",\n  \"Ǐ\": \"I\",\n  \"Î\": \"I\",\n  \"Ï\": \"I\",\n  \"Ḯ\": \"I\",\n  \"İ\": \"I\",\n  \"Ị\": \"I\",\n  \"Ȉ\": \"I\",\n  \"Ì\": \"I\",\n  \"Ỉ\": \"I\",\n  \"Ȋ\": \"I\",\n  \"Ī\": \"I\",\n  \"Į\": \"I\",\n  \"Ɨ\": \"I\",\n  \"Ĩ\": \"I\",\n  \"Ḭ\": \"I\",\n  \"Ꝺ\": \"D\",\n  \"Ꝼ\": \"F\",\n  \"Ᵹ\": \"G\",\n  \"Ꞃ\": \"R\",\n  \"Ꞅ\": \"S\",\n  \"Ꞇ\": \"T\",\n  \"Ꝭ\": \"IS\",\n  \"Ĵ\": \"J\",\n  \"Ɉ\": \"J\",\n  \"Ḱ\": \"K\",\n  \"Ǩ\": \"K\",\n  \"Ķ\": \"K\",\n  \"Ⱪ\": \"K\",\n  \"Ꝃ\": \"K\",\n  \"Ḳ\": \"K\",\n  \"Ƙ\": \"K\",\n  \"Ḵ\": \"K\",\n  \"Ꝁ\": \"K\",\n  \"Ꝅ\": \"K\",\n  \"Ĺ\": \"L\",\n  \"Ƚ\": \"L\",\n  \"Ľ\": \"L\",\n  \"Ļ\": \"L\",\n  \"Ḽ\": \"L\",\n  \"Ḷ\": \"L\",\n  \"Ḹ\": \"L\",\n  \"Ⱡ\": \"L\",\n  \"Ꝉ\": \"L\",\n  \"Ḻ\": \"L\",\n  \"Ŀ\": \"L\",\n  \"Ɫ\": \"L\",\n  \"ǈ\": \"L\",\n  \"Ł\": \"L\",\n  \"Ǉ\": \"LJ\",\n  \"Ḿ\": \"M\",\n  \"Ṁ\": \"M\",\n  \"Ṃ\": \"M\",\n  \"Ɱ\": \"M\",\n  \"Ń\": \"N\",\n  \"Ň\": \"N\",\n  \"Ņ\": \"N\",\n  \"Ṋ\": \"N\",\n  \"Ṅ\": \"N\",\n  \"Ṇ\": \"N\",\n  \"Ǹ\": \"N\",\n  \"Ɲ\": \"N\",\n  \"Ṉ\": \"N\",\n  \"Ƞ\": \"N\",\n  \"ǋ\": \"N\",\n  \"Ñ\": \"N\",\n  \"Ǌ\": \"NJ\",\n  \"Ó\": \"O\",\n  \"Ŏ\": \"O\",\n  \"Ǒ\": \"O\",\n  \"Ô\": \"O\",\n  \"Ố\": \"O\",\n  \"Ộ\": \"O\",\n  \"Ồ\": \"O\",\n  \"Ổ\": \"O\",\n  \"Ỗ\": \"O\",\n  \"Ö\": \"O\",\n  \"Ȫ\": \"O\",\n  \"Ȯ\": \"O\",\n  \"Ȱ\": \"O\",\n  \"Ọ\": \"O\",\n  \"Ő\": \"O\",\n  \"Ȍ\": \"O\",\n  \"Ò\": \"O\",\n  \"Ỏ\": \"O\",\n  \"Ơ\": \"O\",\n  \"Ớ\": \"O\",\n  \"Ợ\": \"O\",\n  \"Ờ\": \"O\",\n  \"Ở\": \"O\",\n  \"Ỡ\": \"O\",\n  \"Ȏ\": \"O\",\n  \"Ꝋ\": \"O\",\n  \"Ꝍ\": \"O\",\n  \"Ō\": \"O\",\n  \"Ṓ\": \"O\",\n  \"Ṑ\": \"O\",\n  \"Ɵ\": \"O\",\n  \"Ǫ\": \"O\",\n  \"Ǭ\": \"O\",\n  \"Ø\": \"O\",\n  \"Ǿ\": \"O\",\n  \"Õ\": \"O\",\n  \"Ṍ\": \"O\",\n  \"Ṏ\": \"O\",\n  \"Ȭ\": \"O\",\n  \"Ƣ\": \"OI\",\n  \"Ꝏ\": \"OO\",\n  \"Ɛ\": \"E\",\n  \"Ɔ\": \"O\",\n  \"Ȣ\": \"OU\",\n  \"Ṕ\": \"P\",\n  \"Ṗ\": \"P\",\n  \"Ꝓ\": \"P\",\n  \"Ƥ\": \"P\",\n  \"Ꝕ\": \"P\",\n  \"Ᵽ\": \"P\",\n  \"Ꝑ\": \"P\",\n  \"Ꝙ\": \"Q\",\n  \"Ꝗ\": \"Q\",\n  \"Ŕ\": \"R\",\n  \"Ř\": \"R\",\n  \"Ŗ\": \"R\",\n  \"Ṙ\": \"R\",\n  \"Ṛ\": \"R\",\n  \"Ṝ\": \"R\",\n  \"Ȑ\": \"R\",\n  \"Ȓ\": \"R\",\n  \"Ṟ\": \"R\",\n  \"Ɍ\": \"R\",\n  \"Ɽ\": \"R\",\n  \"Ꜿ\": \"C\",\n  \"Ǝ\": \"E\",\n  \"Ś\": \"S\",\n  \"Ṥ\": \"S\",\n  \"Š\": \"S\",\n  \"Ṧ\": \"S\",\n  \"Ş\": \"S\",\n  \"Ŝ\": \"S\",\n  \"Ș\": \"S\",\n  \"Ṡ\": \"S\",\n  \"Ṣ\": \"S\",\n  \"Ṩ\": \"S\",\n  \"Ť\": \"T\",\n  \"Ţ\": \"T\",\n  \"Ṱ\": \"T\",\n  \"Ț\": \"T\",\n  \"Ⱦ\": \"T\",\n  \"Ṫ\": \"T\",\n  \"Ṭ\": \"T\",\n  \"Ƭ\": \"T\",\n  \"Ṯ\": \"T\",\n  \"Ʈ\": \"T\",\n  \"Ŧ\": \"T\",\n  \"Ɐ\": \"A\",\n  \"Ꞁ\": \"L\",\n  \"Ɯ\": \"M\",\n  \"Ʌ\": \"V\",\n  \"Ꜩ\": \"TZ\",\n  \"Ú\": \"U\",\n  \"Ŭ\": \"U\",\n  \"Ǔ\": \"U\",\n  \"Û\": \"U\",\n  \"Ṷ\": \"U\",\n  \"Ü\": \"U\",\n  \"Ǘ\": \"U\",\n  \"Ǚ\": \"U\",\n  \"Ǜ\": \"U\",\n  \"Ǖ\": \"U\",\n  \"Ṳ\": \"U\",\n  \"Ụ\": \"U\",\n  \"Ű\": \"U\",\n  \"Ȕ\": \"U\",\n  \"Ù\": \"U\",\n  \"Ủ\": \"U\",\n  \"Ư\": \"U\",\n  \"Ứ\": \"U\",\n  \"Ự\": \"U\",\n  \"Ừ\": \"U\",\n  \"Ử\": \"U\",\n  \"Ữ\": \"U\",\n  \"Ȗ\": \"U\",\n  \"Ū\": \"U\",\n  \"Ṻ\": \"U\",\n  \"Ų\": \"U\",\n  \"Ů\": \"U\",\n  \"Ũ\": \"U\",\n  \"Ṹ\": \"U\",\n  \"Ṵ\": \"U\",\n  \"Ꝟ\": \"V\",\n  \"Ṿ\": \"V\",\n  \"Ʋ\": \"V\",\n  \"Ṽ\": \"V\",\n  \"Ꝡ\": \"VY\",\n  \"Ẃ\": \"W\",\n  \"Ŵ\": \"W\",\n  \"Ẅ\": \"W\",\n  \"Ẇ\": \"W\",\n  \"Ẉ\": \"W\",\n  \"Ẁ\": \"W\",\n  \"Ⱳ\": \"W\",\n  \"Ẍ\": \"X\",\n  \"Ẋ\": \"X\",\n  \"Ý\": \"Y\",\n  \"Ŷ\": \"Y\",\n  \"Ÿ\": \"Y\",\n  \"Ẏ\": \"Y\",\n  \"Ỵ\": \"Y\",\n  \"Ỳ\": \"Y\",\n  \"Ƴ\": \"Y\",\n  \"Ỷ\": \"Y\",\n  \"Ỿ\": \"Y\",\n  \"Ȳ\": \"Y\",\n  \"Ɏ\": \"Y\",\n  \"Ỹ\": \"Y\",\n  \"Ź\": \"Z\",\n  \"Ž\": \"Z\",\n  \"Ẑ\": \"Z\",\n  \"Ⱬ\": \"Z\",\n  \"Ż\": \"Z\",\n  \"Ẓ\": \"Z\",\n  \"Ȥ\": \"Z\",\n  \"Ẕ\": \"Z\",\n  \"Ƶ\": \"Z\",\n  \"Ĳ\": \"IJ\",\n  \"Œ\": \"OE\",\n  \"ᴀ\": \"A\",\n  \"ᴁ\": \"AE\",\n  \"ʙ\": \"B\",\n  \"ᴃ\": \"B\",\n  \"ᴄ\": \"C\",\n  \"ᴅ\": \"D\",\n  \"ᴇ\": \"E\",\n  \"ꜰ\": \"F\",\n  \"ɢ\": \"G\",\n  \"ʛ\": \"G\",\n  \"ʜ\": \"H\",\n  \"ɪ\": \"I\",\n  \"ʁ\": \"R\",\n  \"ᴊ\": \"J\",\n  \"ᴋ\": \"K\",\n  \"ʟ\": \"L\",\n  \"ᴌ\": \"L\",\n  \"ᴍ\": \"M\",\n  \"ɴ\": \"N\",\n  \"ᴏ\": \"O\",\n  \"ɶ\": \"OE\",\n  \"ᴐ\": \"O\",\n  \"ᴕ\": \"OU\",\n  \"ᴘ\": \"P\",\n  \"ʀ\": \"R\",\n  \"ᴎ\": \"N\",\n  \"ᴙ\": \"R\",\n  \"ꜱ\": \"S\",\n  \"ᴛ\": \"T\",\n  \"ⱻ\": \"E\",\n  \"ᴚ\": \"R\",\n  \"ᴜ\": \"U\",\n  \"ᴠ\": \"V\",\n  \"ᴡ\": \"W\",\n  \"ʏ\": \"Y\",\n  \"ᴢ\": \"Z\",\n  \"á\": \"a\",\n  \"ă\": \"a\",\n  \"ắ\": \"a\",\n  \"ặ\": \"a\",\n  \"ằ\": \"a\",\n  \"ẳ\": \"a\",\n  \"ẵ\": \"a\",\n  \"ǎ\": \"a\",\n  \"â\": \"a\",\n  \"ấ\": \"a\",\n  \"ậ\": \"a\",\n  \"ầ\": \"a\",\n  \"ẩ\": \"a\",\n  \"ẫ\": \"a\",\n  \"ä\": \"a\",\n  \"ǟ\": \"a\",\n  \"ȧ\": \"a\",\n  \"ǡ\": \"a\",\n  \"ạ\": \"a\",\n  \"ȁ\": \"a\",\n  \"à\": \"a\",\n  \"ả\": \"a\",\n  \"ȃ\": \"a\",\n  \"ā\": \"a\",\n  \"ą\": \"a\",\n  \"ᶏ\": \"a\",\n  \"ẚ\": \"a\",\n  \"å\": \"a\",\n  \"ǻ\": \"a\",\n  \"ḁ\": \"a\",\n  \"ⱥ\": \"a\",\n  \"ã\": \"a\",\n  \"ꜳ\": \"aa\",\n  \"æ\": \"ae\",\n  \"ǽ\": \"ae\",\n  \"ǣ\": \"ae\",\n  \"ꜵ\": \"ao\",\n  \"ꜷ\": \"au\",\n  \"ꜹ\": \"av\",\n  \"ꜻ\": \"av\",\n  \"ꜽ\": \"ay\",\n  \"ḃ\": \"b\",\n  \"ḅ\": \"b\",\n  \"ɓ\": \"b\",\n  \"ḇ\": \"b\",\n  \"ᵬ\": \"b\",\n  \"ᶀ\": \"b\",\n  \"ƀ\": \"b\",\n  \"ƃ\": \"b\",\n  \"ɵ\": \"o\",\n  \"ć\": \"c\",\n  \"č\": \"c\",\n  \"ç\": \"c\",\n  \"ḉ\": \"c\",\n  \"ĉ\": \"c\",\n  \"ɕ\": \"c\",\n  \"ċ\": \"c\",\n  \"ƈ\": \"c\",\n  \"ȼ\": \"c\",\n  \"ď\": \"d\",\n  \"ḑ\": \"d\",\n  \"ḓ\": \"d\",\n  \"ȡ\": \"d\",\n  \"ḋ\": \"d\",\n  \"ḍ\": \"d\",\n  \"ɗ\": \"d\",\n  \"ᶑ\": \"d\",\n  \"ḏ\": \"d\",\n  \"ᵭ\": \"d\",\n  \"ᶁ\": \"d\",\n  \"đ\": \"d\",\n  \"ɖ\": \"d\",\n  \"ƌ\": \"d\",\n  \"ı\": \"i\",\n  \"ȷ\": \"j\",\n  \"ɟ\": \"j\",\n  \"ʄ\": \"j\",\n  \"ǳ\": \"dz\",\n  \"ǆ\": \"dz\",\n  \"é\": \"e\",\n  \"ĕ\": \"e\",\n  \"ě\": \"e\",\n  \"ȩ\": \"e\",\n  \"ḝ\": \"e\",\n  \"ê\": \"e\",\n  \"ế\": \"e\",\n  \"ệ\": \"e\",\n  \"ề\": \"e\",\n  \"ể\": \"e\",\n  \"ễ\": \"e\",\n  \"ḙ\": \"e\",\n  \"ë\": \"e\",\n  \"ė\": \"e\",\n  \"ẹ\": \"e\",\n  \"ȅ\": \"e\",\n  \"è\": \"e\",\n  \"ẻ\": \"e\",\n  \"ȇ\": \"e\",\n  \"ē\": \"e\",\n  \"ḗ\": \"e\",\n  \"ḕ\": \"e\",\n  \"ⱸ\": \"e\",\n  \"ę\": \"e\",\n  \"ᶒ\": \"e\",\n  \"ɇ\": \"e\",\n  \"ẽ\": \"e\",\n  \"ḛ\": \"e\",\n  \"ꝫ\": \"et\",\n  \"ḟ\": \"f\",\n  \"ƒ\": \"f\",\n  \"ᵮ\": \"f\",\n  \"ᶂ\": \"f\",\n  \"ǵ\": \"g\",\n  \"ğ\": \"g\",\n  \"ǧ\": \"g\",\n  \"ģ\": \"g\",\n  \"ĝ\": \"g\",\n  \"ġ\": \"g\",\n  \"ɠ\": \"g\",\n  \"ḡ\": \"g\",\n  \"ᶃ\": \"g\",\n  \"ǥ\": \"g\",\n  \"ḫ\": \"h\",\n  \"ȟ\": \"h\",\n  \"ḩ\": \"h\",\n  \"ĥ\": \"h\",\n  \"ⱨ\": \"h\",\n  \"ḧ\": \"h\",\n  \"ḣ\": \"h\",\n  \"ḥ\": \"h\",\n  \"ɦ\": \"h\",\n  \"ẖ\": \"h\",\n  \"ħ\": \"h\",\n  \"ƕ\": \"hv\",\n  \"í\": \"i\",\n  \"ĭ\": \"i\",\n  \"ǐ\": \"i\",\n  \"î\": \"i\",\n  \"ï\": \"i\",\n  \"ḯ\": \"i\",\n  \"ị\": \"i\",\n  \"ȉ\": \"i\",\n  \"ì\": \"i\",\n  \"ỉ\": \"i\",\n  \"ȋ\": \"i\",\n  \"ī\": \"i\",\n  \"į\": \"i\",\n  \"ᶖ\": \"i\",\n  \"ɨ\": \"i\",\n  \"ĩ\": \"i\",\n  \"ḭ\": \"i\",\n  \"ꝺ\": \"d\",\n  \"ꝼ\": \"f\",\n  \"ᵹ\": \"g\",\n  \"ꞃ\": \"r\",\n  \"ꞅ\": \"s\",\n  \"ꞇ\": \"t\",\n  \"ꝭ\": \"is\",\n  \"ǰ\": \"j\",\n  \"ĵ\": \"j\",\n  \"ʝ\": \"j\",\n  \"ɉ\": \"j\",\n  \"ḱ\": \"k\",\n  \"ǩ\": \"k\",\n  \"ķ\": \"k\",\n  \"ⱪ\": \"k\",\n  \"ꝃ\": \"k\",\n  \"ḳ\": \"k\",\n  \"ƙ\": \"k\",\n  \"ḵ\": \"k\",\n  \"ᶄ\": \"k\",\n  \"ꝁ\": \"k\",\n  \"ꝅ\": \"k\",\n  \"ĺ\": \"l\",\n  \"ƚ\": \"l\",\n  \"ɬ\": \"l\",\n  \"ľ\": \"l\",\n  \"ļ\": \"l\",\n  \"ḽ\": \"l\",\n  \"ȴ\": \"l\",\n  \"ḷ\": \"l\",\n  \"ḹ\": \"l\",\n  \"ⱡ\": \"l\",\n  \"ꝉ\": \"l\",\n  \"ḻ\": \"l\",\n  \"ŀ\": \"l\",\n  \"ɫ\": \"l\",\n  \"ᶅ\": \"l\",\n  \"ɭ\": \"l\",\n  \"ł\": \"l\",\n  \"ǉ\": \"lj\",\n  \"ſ\": \"s\",\n  \"ẜ\": \"s\",\n  \"ẛ\": \"s\",\n  \"ẝ\": \"s\",\n  \"ḿ\": \"m\",\n  \"ṁ\": \"m\",\n  \"ṃ\": \"m\",\n  \"ɱ\": \"m\",\n  \"ᵯ\": \"m\",\n  \"ᶆ\": \"m\",\n  \"ń\": \"n\",\n  \"ň\": \"n\",\n  \"ņ\": \"n\",\n  \"ṋ\": \"n\",\n  \"ȵ\": \"n\",\n  \"ṅ\": \"n\",\n  \"ṇ\": \"n\",\n  \"ǹ\": \"n\",\n  \"ɲ\": \"n\",\n  \"ṉ\": \"n\",\n  \"ƞ\": \"n\",\n  \"ᵰ\": \"n\",\n  \"ᶇ\": \"n\",\n  \"ɳ\": \"n\",\n  \"ñ\": \"n\",\n  \"ǌ\": \"nj\",\n  \"ó\": \"o\",\n  \"ŏ\": \"o\",\n  \"ǒ\": \"o\",\n  \"ô\": \"o\",\n  \"ố\": \"o\",\n  \"ộ\": \"o\",\n  \"ồ\": \"o\",\n  \"ổ\": \"o\",\n  \"ỗ\": \"o\",\n  \"ö\": \"o\",\n  \"ȫ\": \"o\",\n  \"ȯ\": \"o\",\n  \"ȱ\": \"o\",\n  \"ọ\": \"o\",\n  \"ő\": \"o\",\n  \"ȍ\": \"o\",\n  \"ò\": \"o\",\n  \"ỏ\": \"o\",\n  \"ơ\": \"o\",\n  \"ớ\": \"o\",\n  \"ợ\": \"o\",\n  \"ờ\": \"o\",\n  \"ở\": \"o\",\n  \"ỡ\": \"o\",\n  \"ȏ\": \"o\",\n  \"ꝋ\": \"o\",\n  \"ꝍ\": \"o\",\n  \"ⱺ\": \"o\",\n  \"ō\": \"o\",\n  \"ṓ\": \"o\",\n  \"ṑ\": \"o\",\n  \"ǫ\": \"o\",\n  \"ǭ\": \"o\",\n  \"ø\": \"o\",\n  \"ǿ\": \"o\",\n  \"õ\": \"o\",\n  \"ṍ\": \"o\",\n  \"ṏ\": \"o\",\n  \"ȭ\": \"o\",\n  \"ƣ\": \"oi\",\n  \"ꝏ\": \"oo\",\n  \"ɛ\": \"e\",\n  \"ᶓ\": \"e\",\n  \"ɔ\": \"o\",\n  \"ᶗ\": \"o\",\n  \"ȣ\": \"ou\",\n  \"ṕ\": \"p\",\n  \"ṗ\": \"p\",\n  \"ꝓ\": \"p\",\n  \"ƥ\": \"p\",\n  \"ᵱ\": \"p\",\n  \"ᶈ\": \"p\",\n  \"ꝕ\": \"p\",\n  \"ᵽ\": \"p\",\n  \"ꝑ\": \"p\",\n  \"ꝙ\": \"q\",\n  \"ʠ\": \"q\",\n  \"ɋ\": \"q\",\n  \"ꝗ\": \"q\",\n  \"ŕ\": \"r\",\n  \"ř\": \"r\",\n  \"ŗ\": \"r\",\n  \"ṙ\": \"r\",\n  \"ṛ\": \"r\",\n  \"ṝ\": \"r\",\n  \"ȑ\": \"r\",\n  \"ɾ\": \"r\",\n  \"ᵳ\": \"r\",\n  \"ȓ\": \"r\",\n  \"ṟ\": \"r\",\n  \"ɼ\": \"r\",\n  \"ᵲ\": \"r\",\n  \"ᶉ\": \"r\",\n  \"ɍ\": \"r\",\n  \"ɽ\": \"r\",\n  \"ↄ\": \"c\",\n  \"ꜿ\": \"c\",\n  \"ɘ\": \"e\",\n  \"ɿ\": \"r\",\n  \"ś\": \"s\",\n  \"ṥ\": \"s\",\n  \"š\": \"s\",\n  \"ṧ\": \"s\",\n  \"ş\": \"s\",\n  \"ŝ\": \"s\",\n  \"ș\": \"s\",\n  \"ṡ\": \"s\",\n  \"ṣ\": \"s\",\n  \"ṩ\": \"s\",\n  \"ʂ\": \"s\",\n  \"ᵴ\": \"s\",\n  \"ᶊ\": \"s\",\n  \"ȿ\": \"s\",\n  \"ɡ\": \"g\",\n  \"ᴑ\": \"o\",\n  \"ᴓ\": \"o\",\n  \"ᴝ\": \"u\",\n  \"ť\": \"t\",\n  \"ţ\": \"t\",\n  \"ṱ\": \"t\",\n  \"ț\": \"t\",\n  \"ȶ\": \"t\",\n  \"ẗ\": \"t\",\n  \"ⱦ\": \"t\",\n  \"ṫ\": \"t\",\n  \"ṭ\": \"t\",\n  \"ƭ\": \"t\",\n  \"ṯ\": \"t\",\n  \"ᵵ\": \"t\",\n  \"ƫ\": \"t\",\n  \"ʈ\": \"t\",\n  \"ŧ\": \"t\",\n  \"ᵺ\": \"th\",\n  \"ɐ\": \"a\",\n  \"ᴂ\": \"ae\",\n  \"ǝ\": \"e\",\n  \"ᵷ\": \"g\",\n  \"ɥ\": \"h\",\n  \"ʮ\": \"h\",\n  \"ʯ\": \"h\",\n  \"ᴉ\": \"i\",\n  \"ʞ\": \"k\",\n  \"ꞁ\": \"l\",\n  \"ɯ\": \"m\",\n  \"ɰ\": \"m\",\n  \"ᴔ\": \"oe\",\n  \"ɹ\": \"r\",\n  \"ɻ\": \"r\",\n  \"ɺ\": \"r\",\n  \"ⱹ\": \"r\",\n  \"ʇ\": \"t\",\n  \"ʌ\": \"v\",\n  \"ʍ\": \"w\",\n  \"ʎ\": \"y\",\n  \"ꜩ\": \"tz\",\n  \"ú\": \"u\",\n  \"ŭ\": \"u\",\n  \"ǔ\": \"u\",\n  \"û\": \"u\",\n  \"ṷ\": \"u\",\n  \"ü\": \"u\",\n  \"ǘ\": \"u\",\n  \"ǚ\": \"u\",\n  \"ǜ\": \"u\",\n  \"ǖ\": \"u\",\n  \"ṳ\": \"u\",\n  \"ụ\": \"u\",\n  \"ű\": \"u\",\n  \"ȕ\": \"u\",\n  \"ù\": \"u\",\n  \"ủ\": \"u\",\n  \"ư\": \"u\",\n  \"ứ\": \"u\",\n  \"ự\": \"u\",\n  \"ừ\": \"u\",\n  \"ử\": \"u\",\n  \"ữ\": \"u\",\n  \"ȗ\": \"u\",\n  \"ū\": \"u\",\n  \"ṻ\": \"u\",\n  \"ų\": \"u\",\n  \"ᶙ\": \"u\",\n  \"ů\": \"u\",\n  \"ũ\": \"u\",\n  \"ṹ\": \"u\",\n  \"ṵ\": \"u\",\n  \"ᵫ\": \"ue\",\n  \"ꝸ\": \"um\",\n  \"ⱴ\": \"v\",\n  \"ꝟ\": \"v\",\n  \"ṿ\": \"v\",\n  \"ʋ\": \"v\",\n  \"ᶌ\": \"v\",\n  \"ⱱ\": \"v\",\n  \"ṽ\": \"v\",\n  \"ꝡ\": \"vy\",\n  \"ẃ\": \"w\",\n  \"ŵ\": \"w\",\n  \"ẅ\": \"w\",\n  \"ẇ\": \"w\",\n  \"ẉ\": \"w\",\n  \"ẁ\": \"w\",\n  \"ⱳ\": \"w\",\n  \"ẘ\": \"w\",\n  \"ẍ\": \"x\",\n  \"ẋ\": \"x\",\n  \"ᶍ\": \"x\",\n  \"ý\": \"y\",\n  \"ŷ\": \"y\",\n  \"ÿ\": \"y\",\n  \"ẏ\": \"y\",\n  \"ỵ\": \"y\",\n  \"ỳ\": \"y\",\n  \"ƴ\": \"y\",\n  \"ỷ\": \"y\",\n  \"ỿ\": \"y\",\n  \"ȳ\": \"y\",\n  \"ẙ\": \"y\",\n  \"ɏ\": \"y\",\n  \"ỹ\": \"y\",\n  \"ź\": \"z\",\n  \"ž\": \"z\",\n  \"ẑ\": \"z\",\n  \"ʑ\": \"z\",\n  \"ⱬ\": \"z\",\n  \"ż\": \"z\",\n  \"ẓ\": \"z\",\n  \"ȥ\": \"z\",\n  \"ẕ\": \"z\",\n  \"ᵶ\": \"z\",\n  \"ᶎ\": \"z\",\n  \"ʐ\": \"z\",\n  \"ƶ\": \"z\",\n  \"ɀ\": \"z\",\n  \"ﬀ\": \"ff\",\n  \"ﬃ\": \"ffi\",\n  \"ﬄ\": \"ffl\",\n  \"ﬁ\": \"fi\",\n  \"ﬂ\": \"fl\",\n  \"ĳ\": \"ij\",\n  \"œ\": \"oe\",\n  \"ﬆ\": \"st\",\n  \"ₐ\": \"a\",\n  \"ₑ\": \"e\",\n  \"ᵢ\": \"i\",\n  \"ⱼ\": \"j\",\n  \"ₒ\": \"o\",\n  \"ᵣ\": \"r\",\n  \"ᵤ\": \"u\",\n  \"ᵥ\": \"v\",\n  \"ₓ\": \"x\"\n};\n\nString.prototype.latinise = function() {\n  return this.replace(/[^A-Za-z0-9\\[\\] ]/g, function(a) {\n    return Latinise.latin_map[a] || a\n  })\n};\nString.prototype.latinize = String.prototype.latinise;\nString.prototype.isLatin = function() {\n  return this == this.latinise()\n}\n\n//----------------------------------------------------------------------------------------\nfunction clean_string(s) {\n\n  // extraneous text, such as \"No.\"\n  s = s.replace(/\\s+no\\.?$/i, '');\n\n  s = s.latinise();\n  s = s.toLowerCase();\n\n  // stop words\n  s = s.replace(/\\bfor\\b/g, '');\n  s = s.replace(/\\band\\b/g, '')\n  s = s.replace(/\\bof\\b/g, '');\n  s = s.replace(/\\bthe\\b/g, '');\n\n  s = s.replace(/\\bde\\b/g, '');\n  s = s.replace(/\\bla\\b/g, '');\n  s = s.replace(/\\bet\\b/g, '');\n\n  s = s.replace(/\\baus\\b/g, '');\n  s = s.replace(/\\bdem\\b/g, '');\n  s = s.replace(/\\bder\\b/g, '');\n  s = s.replace(/\\bfur\\b/g, '');\n  s = s.replace(/\\bund\\b/g, '');\n  s = s.replace(/\\bzur\\b/g, '');\n\n  // abbreviated stop words\n  s = s.replace(/\\s*\\&\\s*/g, '');\n\n  // white space\n  s = s.replace(/\\s+/g, '');\n\n  // punctuation\n  s = s.replace(/\\./g, '');\n  s = s.replace(/\\'/g, '');\n  s = s.replace(/,/g, '');\n  s = s.replace(/\\(/g, '');\n  s = s.replace(/\\)/g, '');\n  s = s.replace(/\\-/g, '');\n  s = s.replace(/’/g, '');\n  return s;\n}\n\nvar journal_to_issn = {\n\n  \"Acarologia\": \"0044-586X\",\n\n  \"American Museum Novitates\": \"0003-0082\",\n\n  \"Annales de la Société Entomologique de France\": \"0037-9271\",\n\n  \"Australian Entomological Magazine\": \"0311-1881\",\n  \"The Australian entomological magazine\": \"0311-1881\",\n\n  \"Australian Journal of Zoology\": \"0004-959X\",\n  \"Aust J Zool\": \"0004-959X\",\n\n  \"Aust J Zool, Supplementary Series\": \"0310-9089\",\n\n  \"Aust. Zool.\": \"0067-2238\",\n  \"Australian Zoologist\": \"0067-2238\",\n\n  \"Bulletin of Marine Science\": \"0007-4977\",\n\n  \"Bulletin of the American Museum of Natural History\": \"0003-0090\",\n\n  \"Bulletin of the British Arachnological Society\": \"0524-4994\",\n\n  \"Bulletin of Zoological Nomenclature\": \"0007-5167\",\n\n  \"Conserv Genet\": \"1566-0621\",\n\n  \"Entomologische Mitteilungen\": \"0071-0806\",\n\n  \"Journal of Arachnology\": \"0161-8202\",\n  \"The Journal of Arachnology\": \"0161-8202\",\n\n  \"Journal of The American Mosquito Control Association\": \"8756-971X\",\n  \"J Am Mosq Control Assoc\": \"8756-971X\",\n  \"J Amer Mosq Contr Assoc\": \"8756-971X\",\n\n  \"Journal of the Australian Entomological Society\": \"1326-6756\",\n  \"The Journal of the Entomological Society of Australia (N.S.W.)\": \"1326-6756\",\n\n  \"Journal of the Malacological Society of Australia\": \"0085-2998\",\n  \"J. malac. Soc. Aust.\": \"0085-2998\",\n\n  \"Journal of the Royal Society of Western Australia\": \"0035-922X\",\n\n  \"Linzer Biologische Beiträge\": \"0253-116X\",\n\n  \"Malacologia\": \"0076-2997\",\n\n  \"Memoirs of the National Museum of Victoria\": \"0083-5986\",\n  \"Memoirs of the National Museum, Victoria\": \"0083-5986\",\n  \"Memoirs of the National Museum, Melbourne\": \"0311-9548\",\n\n  \"Memoirs of the Queensland Museum\": \"0079-8835\",\n  \"Memoirs Qld Mus\": \"0079-8835\",\n  \"Memoirs of the Queensland Museum - Nature\": \"0079-8835\",\n\n  \"Molluscan Research\": \"1323-5818\",\n\n  \"Mosquito Systematics\": \"0091-3669\",\n\n  \"Nautilus\": \"0028-1344\",\n  \"The Nautilus\": \"0028-1344\",\n\n  \"Novitates Zoologicae\": \"0950-7655\",\n\n  \"Papers and Proceedings of the Royal Society of Tasmania\": \"0080-4703\",\n  \"Pap. Proc. R. Soc. Tasm.\": \"0080-4703\",\n  \"Proceedings Royal Society Tasmania, Hobart\": \"0080-4703\",\n\n  \"Proceedings of the Biological Society of Washington\": \"0006-324X\",\n\n  \"Proceedings of the California Academy of Sciences\": \"0068-547X\",\n\n  \"Proceedings of the Entomological Society of Washington\": \"0013-8797\",\n\n  \"Proceedings of the Linnean Society of New South Wales\": \"0370-047X\",\n  \"Proc. Linn. Soc. N.S.W\": \"0370-047X\",\n\n  \"Proc. malac. Soc. Lond.\": \"0025-1194\",\n  \"Proc. malac. Soc. Loud.\": \"0025-1194\",\n  \"Proceedings of the Malacological Society of London\": \"0025-1194\",\n\n  \"Proceedings of The Royal Society of Queensland\": \"0080-469X\",\n  \"Proceedings of the Royal Society of Victoria\": \"0035-9211\",\n  \"Proceedings of the United States National Museum\": \"0096-3801\",\n\n  \"Proc. zool. Soc. Lond.\": \"0370-2774\",\n  \"Proceedings of th Zoological Society of London\": \"0370-2774\",\n  \"Proceedings of the Zoological Society of London\": \"0370-2774\",\n\n  \"Rec South Aust Mus\": \"0376-2750\",\n  \"Rec South Austr Mus\": \"0376-2750\",\n  \"Records of the South Australian Museum\": \"0376-2750\",\n\n  \"Records of the Indian Museum\": \"0375-099X\",\n\n  \"Records of the Western Australian Museum\": \"0312-3162\",\n  \"Records of the Western Australian Museum Suppl.\": \"0313-122X\",\n  \"Records of the Western Australian Museum Supplement\": \"0313-122X\",\n\n  \"Revue Arachnologique\": \"0398-4346\",\n\n  \"Systematic Biology\": \"1063-5157\",\n  \"Systematic Zoology\": \"0039-7989\",\n\n  \"Transactions of the Royal Society of South Australia\": \"0372-1426\",\n  \"Trans. R. Soc. South Aust.\": \"0372-1426\",\n  \"T Roy Soc South Aus\": \"0372-1426\",\n\n  \"Veliger\": \"0042-3211\",\n  \"The Veliger\": \"0042-3211\",\n\n  \"Venus\": \"0042-3580\",\n  \"The Venus\": \"0042-3580\",\n\n  \"Victorian Naturalist\": \"0042-5184\",\n  \"Victorian Naturalist Melbourne\": \"0042-5184\",\n  \"The Victorian Naturalist\": \"0042-5184\",\n\n  \"Western Australian naturalist\": \"0508-4865\",\n  \"The Western Australian naturalist\": \"0508-4865\",\n\n  \"Zootaxa\": \"1175-5326\"\n\n};\n\n//----------------------------------------------------------------------------------------\nfunction build_lookup_table(journal_to_issn) {\n  lookup_table = {};\n\n  for (var i in journal_to_issn) {\n    lookup_table[clean_string(i)] = journal_to_issn[i];\n  }\n\n  return lookup_table;\n}\n\n//----------------------------------------------------------------------------------------\nfunction message(doc) {\n  if (doc.message) {\n\n    lookup_table = build_lookup_table(journal_to_issn);\n\n    var subject_id = doc._id.toLowerCase();\n    subject_id = subject_id.replace(/https:\\/\\/daisy-pine.glitch.me\\/summary\\?q=/, '');\n    \n    if (doc.message.DOI) {\n    \tsubject_id = 'https://doi.org/' + doc.message.DOI.toLowerCase();\n    }\n\n    var triples = [];\n\n    for (var i in doc.message) {\n      switch (i) {\n\n        case 'DOI':\n          // Add DOI as identifier\n          var identifier_id = subject_id + '#doi';\n\n          triples.push(triple(subject_id,\n            'http://schema.org/identifier',\n            identifier_id));\n\n          triples.push(triple(identifier_id,\n            'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n            'http://schema.org/PropertyValue'));\n\n          triples.push(triple(identifier_id,\n            'http://schema.org/propertyID',\n            'doi'));\n\n          triples.push(triple(identifier_id,\n            'http://schema.org/value',\n            doc.message[i].toLowerCase()\n          ));\n\n\n          break;\n\n          /*\n                \"reference\": [\n                     {\n                         \"key\": \"11192_B1\",\n                         \"first-page\": \"119\",\n                         \"article-title\": \"Pseudocrangonyx, a new genus of subterranean amphipods from Japan.\",\n                         \"volume\": \"10\",\n                         \"author\": \"Akatsuka\",\n                         \"year\": \"1922\",\n                         \"journal-title\": \"Annotationes Zoologicae Japonenses\"\n                     },\n           */\n        case 'reference':\n          var n = doc.message[i].length;\n          for (var j = 0; j < n; j++) {\n\n            var reference_id = '';\n\n            if (doc.message[i][j].DOI) {\n\n              // DOI is id for citation\n              reference_id = \"https://doi.org/\" + doc.message[i][j].DOI.toLowerCase();\n              \n              // DOI cleaning (sigh)\n              /* Sometimes publishes make a mess of this, e.g. \n              http://dx.doi.org/10.1111/j.1096-0031.2007.00176.x\n              {\n                key: \"b129_103\",\n                DOI: \"10.1636/H05-14 SC.1\",\n                doi-asserted-by: \"publisher\"\n              }\n              */\n              reference_id = reference_id.replace(/sc.1?/g, '');\n              reference_id = reference_id.replace(/\\s/g, '');              \n\n              // Add DOI as identifier\n              var identifier_id = reference_id + '#doi';\n\n              triples.push(triple(reference_id,\n                'http://schema.org/identifier',\n                identifier_id));\n\n              triples.push(triple(identifier_id,\n                'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n                'http://schema.org/PropertyValue'));\n\n              triples.push(triple(identifier_id,\n                'http://schema.org/propertyID',\n                'doi'));\n\n              triples.push(triple(identifier_id,\n                'http://schema.org/value',\n                doc.message[i][j].DOI.toLowerCase()\n              ));\n\n            } else {\n\n              // No DOI so make a SICI-style identifier to help match \n              if (doc.message[i][j]['journal-title']) {\n\n                // identifier for cited reference\n                var key = doc.message[i][j].key;\n\n                key = key.replace(/\\t/g, '');\n                key = key.replace(/\\n/g, '');\n\n                // replace characters not allowed\n                key = key.replace(/\\|/g, '-');\n                key = key.replace(/\\//g, '-');\n                key = key.replace(/\\./g, '-');\n                key = key.replace(/\\s/g, '-');\n\n                reference_id = subject_id + \"/reference\" + \"#\" + key;\n\n                var journal = clean_string(doc.message[i][j]['journal-title']);\n\n                if (lookup_table[journal]) {\n                  var issn = lookup_table[journal];\n\n                  var sici = [];\n                  sici.push(issn);\n\n                  if (doc.message[i][j].year) {\n                    year = doc.message[i][j].year;\n                    year = year.replace(/[a-z]$/, '');\n                    sici.push('(' + year + ')');\n                  }\n\n                  if (doc.message[i][j].volume) {\n                    sici.push(doc.message[i][j].volume);\n                  }\n\n                  if (doc.message[i][j]['first-page']) {\n                    sici.push('<' + doc.message[i][j]['first-page'] + '>');\n                  }\n\n                  if (sici.length == 4) {\n                    // Add SICI as identifier\n                    var identifier_id = reference_id + '#sici';\n\n                    triples.push(triple(reference_id,\n                      'http://schema.org/identifier',\n                      identifier_id));\n\n                    triples.push(triple(identifier_id,\n                      'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n                      'http://schema.org/PropertyValue'));\n\n                    triples.push(triple(identifier_id,\n                      'http://schema.org/propertyID',\n                      'sici'));\n\n                    triples.push(triple(identifier_id,\n                      'http://schema.org/value',\n                      sici.join('')\n                    ));\n\n                  }\n                }\n              }\n            }\n\n            // citation link\n            if (reference_id != '') {\n              triples.push(triple(subject_id,\n                'http://schema.org/citation',\n                reference_id));\n            }\n          }\n          break;\n\n        default:\n          break;\n      }\n    }\n\n    output(doc, triples);\n  }\n}\n\nfunction(doc) {\n  if (doc['message-format']) {\n    if (doc['message-format'] == 'application/vnd.citationstyles.csl+json') {\n      if (doc._id.match(/https:\\/\\/daisy-pine.glitch.me\\//)) {\n        message(doc);\n      }\n    }\n  }\n}"
    }
  },
  "language": "javascript"
}